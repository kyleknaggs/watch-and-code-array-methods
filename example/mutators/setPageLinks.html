<script src="../../simpletest.js"></script>
<script>
  // Summary:
  // Converts an array of page numbers, into an array of strings used to display links to different pages of results for a particular query.

  // Example:
  // var allPages = [1,2,3,4,5,6,7,8,9,10,11];
  // setPageLinks(allPages, 6);
  // >>> returns ["1", "..." , "4", "5", "6", "7", "8", "..." "10", "11"]

  // Prototype implementation:
  // function setPageLinks(allPages, indexOfCurrentPage) {
  // }

  // Function signature:
  // setPageLinks(allPages, indexOfCurrentPage);

  // Arguments:
  // allPages - The complete list of pages that house results for a particular query.
  // Note: allPages.length >= 2 as the component that house setPageLinks() is not displayed if allPages.length < 2.
  // indexOfCurrentPage - The current page that the user is on.

  // Return value:
  // An array of strings to be mapped to buttons in <AfPageList/>

  // Function Syntax:
  function setPageLinks(allPages, indexOfCurrentPage) {
    const allPagesAsStrings = allPages.map(page => String(page));
    const pageLinks = [];
    const numberOfPages = allPagesAsStrings.length;

    function pushLinksToPageLinksArray(startingIndex, endingIndex) {
      for (let i = startingIndex; i < endingIndex; i++) {
        pageLinks.push(allPagesAsStrings[i]);
      }
    }

    // For pages before the current page:
    if (indexOfCurrentPage > 0) {
      pageLinks.push("1");
      if (indexOfCurrentPage > 3) {
        pageLinks.push("...");
        pushLinksToPageLinksArray(indexOfCurrentPage - 2, indexOfCurrentPage);
      } else {
        pushLinksToPageLinksArray(1, indexOfCurrentPage);
      }
    }

    pageLinks.push(allPagesAsStrings[indexOfCurrentPage]);

    // For pages after the current page:
    if (numberOfPages - indexOfCurrentPage > 1) {
      if (numberOfPages - indexOfCurrentPage > 5) {
        pushLinksToPageLinksArray(
          indexOfCurrentPage + 1,
          indexOfCurrentPage + 3
        );
        pageLinks.push("...");
      } else {
        pushLinksToPageLinksArray(indexOfCurrentPage + 1, numberOfPages - 1);
      }
      pageLinks.push(allPagesAsStrings[numberOfPages - 1]);
    }

    return pageLinks;
  }

  // Requirements:

  tests({
    // Basic requirements of returned array:

    "1a) It should return an array.": function() {
      var allPages = [1, 2];
      var pageLinks = setPageLinks(allPages, 0);
      eq(Object.prototype.toString.call(pageLinks), "[object Array]");
    },
    "1b) It should return a new array, not the array that was used as an argument.": function() {
      var allPages = [1, 2];
      var copyOfOriginalArray = allPages;
      var pageLinks = setPageLinks(allPages, 0);
      eq(pageLinks === copyOfOriginalArray, false);
    },

    "2a) It should return an array of strings.": function() {
      var allPages = [1, 2];
      var pageLinks = setPageLinks(allPages, 0);
      eq(Object.prototype.toString.call(pageLinks[0]), "[object String]");
    },

    "3a) It shoud return an array that always begins with 1.": function() {
      var pageList = setPageLinks([1, 2], 0);
      eq(pageList[0], 1);
    },
    "3b) It should return an array whose last element is equal to the value in allPages[allPages.length-1].": function() {
      var lastElementInPageList = 2;
      var pageList = setPageLinks([1, lastElementInPageList], 0);
      eq(pageList[pageList.length - 1], lastElementInPageList);
    },

    // If allPages.length <= 4:

    "4a) If pageList.length <= 4, the length of the returned array should equal pageList.length.": function() {
      var pageList = [1, 2, 3, 4];
      var pageLinks = setPageLinks(pageList, 0);
      eq(pageLinks.length, 4);
    },

    // If "..." does not need to be injected into array:

    "5a) If indexOfCurrentPage <= 3, display all elements before allPages[indexOfCurrentPage].": function() {
      var allPages = [1, 2, 3, 4, 5, 6];
      var indexOfCurrentPage = 3;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(pageLinks[1], "2");
      eq(pageLinks[2], "3");
      eq(pageLinks[3], "4");
    },
    "5b) If <= 3 indicies between indexOfCurrentPage and last element in allPages, do not add '...' after allPages[indexOfCurrentPage]": function() {
      var allPages = [1, 2, 3, 4, 5, 6];
      var indexOfCurrentPage = 2;
      var indexOfLastElement = allPages.length - 1;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(indexOfLastElement - indexOfCurrentPage <= 3, true);
      eq(pageLinks[pageLinks.length - 2], "5");
    },

    // If "..." does need to be injected into array:

    "6a) If indexOfCurrentPage > 3, replace all elements between pageLinks[1] and pageLinks[indexOfCurrentPage-3] with a single '...' element.": function() {
      var allPages = [1, 2, 3, 4, 5, 6];
      var indexOfCurrentPage = 4;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(pageLinks[1], "...");
    },
    "6b) If indexOfLastElement - indexOfCurrentPage > 3, replace all elements between pageLinks(indexOfCurrentPage) and pageLinks[pageLinks.length - 2] with a single '...' element.": function() {
      var allPages = [1, 2, 3, 4, 5, 6];
      var indexOfLastElement = allPages.length - 1;
      var indexOfCurrentPage = 0;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(indexOfLastElement - indexOfCurrentPage > 3, true);
      eq(pageLinks[pageLinks.length - 2], "...");
    },

    // If allPages.length > 4: location of allPages[indexOfCurrentPage] in the returned array:

    "7a) If indexOfCurrentPage is more than 3 elements after the first element in array , the fifth element in pageLinks is equal to pageList[indexOfCurrentPage].": function() {
      var allPages = [1, 2, 3, 4, 5, 6];
      var indexOfCurrentPage = 5;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(pageLinks[4], allPages[indexOfCurrentPage]);
    },
    "7b) If indexOfLastElement - indexOfCurrentPage > 3, the fifth to last element in pageLinks is equal to pageList[indexOfCurrentPage].": function() {
      var allPages = [1, 2, 3, 4, 5, 6];
      var indexOfLastElement = allPages.length - 1;
      var indexOfCurrentPage = 0;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(indexOfLastElement - indexOfCurrentPage > 3, true);
      eq(pageLinks[pageLinks.length - 5], allPages[indexOfCurrentPage]);
    },

    // If allPages.length > 4: the length of the returned array:

    "8a) It should never return an array with more than 9 elements.": function() {
      var allPages = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
      var indexOfCurrentPage = 6;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(pageLinks.length, 9);
    }
  });

  // TODO: Review different test cases:

  // 1) If indexOfCurrentPage is the first page of the array:
  // setPageLinks([1, 2, 3, 4, 5], 1); // >>> ["1", "2", "3", "4", "5"]
  // setPageLinks([1, 2, 3, 4, 5, 6], 1); // >>> ["1", "2", "3", "..." , "6"]

  // 2) If indexOfCurrentPage is the second page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6], 2); // >>> ["1", "2", "3", "4" , "5", "6"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7], 2); // >>> ["1", "2", "3", "4" , "...", "7"]

  // 3) If indexOfCurrentPage is the third page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6, 7], 3); // >>> ["1", "2", "3", "4" , "5", "6", "7"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8], 3); // >>> ["1", "2", "3", "4" , "5", "...", "8"]

  // 4) If indexOfCurrentPage is the fourth page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8], 4); // >>> ["1", "2", "3", "4" , "5", "6", "7", "8"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9], 4); // >>> ["1", "2", "3", "4" , "5", "6", "...", "9"]

  // 5) If indexOfCurrentPage is the fifth page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9], 5); // >>> ["1", "2", "3", "4" , "5", "6", "7", "8", "9"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], 5); // >>> ["1", "2", "3", "4" , "5", "6", "7", "...", "10"]

  // 6) If indexOfCurrentPage is the sixth page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9], 6); // >>> ["1", "...", "4" , "5", "6", "7", "8", "9"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], 6); // >>> ["1", "...", "4" , "5", "6", "7", "8", "9", "10"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], 6); // >>> ["1", "...", "4" , "5", "6", "7", "8", "...", "11"]

  // 7) If indexOfCurrentPage is the seventh page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], 7); // >>> ["1", "...", "5", "6", "7", "8", "9", "10"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], 7); // >>> ["1", "...", "5", "6", "7", "8", "9", "10", "11"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], 7); // >>> ["1", "...", "5", "6", "7", "8", "9", "...", "12"]
</script>
