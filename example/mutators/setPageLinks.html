<script src="../../simpletest.js"></script>
<script>
  // Summary:
  // Converts an array of page numbers, into an array of strings used to display links to different pages of results for a particular query.

  // Example:
  // var allPages = [1,2,3,4,5,6,7,8,9,10,11];
  // setPageLinks(allPages, 6);
  // >>> returns ["1", "..." , "4", "5", "6", "7", "8", "..." "10", "11"]

  // Prototype implementation:
  // function setPageLinks(allPages, indexOfCurrentPage) {
  // }

  // Function signature:
  // setPageLinks(allPages, indexOfCurrentPage);

  // Arguments:
  // allPages - The complete list of pages that house results for a particular query.
  // Note: allPages.length >= 2 as the component that house setPageLinks() is not displayed if allPages.length < 2.
  // indexOfCurrentPage - The current page that the user is on.

  // Return value:
  // An array of strings to be mapped to buttons in <AfPageList/>

  // Function Syntax:
  function setPageLinks(allPages, indexOfCurrentPage) {
    var allPagesAsStrings = allPages.map(function(page) {
      return String(page);
    });
    var pageLinks = [];
    var numberOfPages = allPagesAsStrings.length;

    function pushLinksToPageLinksArray(startingIndex, endingIndex) {
      for (var i = startingIndex; i < endingIndex; i++) {
        pageLinks.push(allPagesAsStrings[i]);
      }
    }

    // If current page is not the first page:
    if (indexOfCurrentPage > 0) {
      pageLinks.push("1");
      if (indexOfCurrentPage > 3) {
        pageLinks.push("...");
        pushLinksToPageLinksArray(indexOfCurrentPage - 2, indexOfCurrentPage);
      } else {
        // Does this need to exist?
        pushLinksToPageLinksArray(1, indexOfCurrentPage);
      }
    }

    // For current page:
    pageLinks.push(allPagesAsStrings[indexOfCurrentPage]);

    // If current page is not the last page:
    if (numberOfPages - indexOfCurrentPage > 1) {
      if (numberOfPages - indexOfCurrentPage > 4) {
        pushLinksToPageLinksArray(indexOfCurrentPage, indexOfCurrentPage + 2);
        pageLinks.push("...");
      } else {
        pushLinksToPageLinksArray(indexOfCurrentPage + 1, numberOfPages - 1);
      }
      pageLinks.push(allPagesAsStrings[numberOfPages - 1]);
    }

    return pageLinks;
  }

  // Requirements:

  tests({
    // Basic requirements of returned array:

    "1a) It should return an array.": function() {
      var allPages = [1, 2];
      var pageLinks = setPageLinks(allPages, 0);
      eq(Object.prototype.toString.call(pageLinks), "[object Array]");
    },
    "1b) The returned array should be a new array, not originalArray": function() {
      var allPages = [1, 2];
      var copyOfOriginalArray = allPages;
      var pageLinks = setPageLinks(allPages, 0);
      eq(pageLinks === copyOfOriginalArray, false);
    },

    "2a) The returned array should only contain strings.": function() {
      var allPages = [1, 2];
      var pageLinks = setPageLinks(allPages, 0);
      eq(Object.prototype.toString.call(pageLinks[0]), "[object String]");
    },

    "3a) The returned array should always begin with 1.": function() {
      var pageList = setPageLinks([1, 2], 0);
      eq(pageList[0], 1);
    },
    "3b) The returned array should always end with the allPages[allPages.length-1].": function() {
      var lastElementInPageList = 2;
      var pageList = setPageLinks([1, lastElementInPageList], 0);
      eq(pageList[pageList.length - 1], lastElementInPageList);
    },

    // If allPages.length <= 4:

    "4a) If pageList.length <= 4, the length of the returned array should equal pageList.length.": function() {
      var pageList = [1, 2, 3, 4];
      var pageLinks = setPageLinks(pageList, 0);
      eq(pageLinks.length, 4);
    },

    // If allPages.length > 4: location of "..." in the returned array:

    "5a) If (indexOfCurrentPage - 1) > 3, replace all elements between pageLinks[1] and pageLinks[indexOfCurrentPage-3] with a single '...' element.": function() {
      var allPages = [1, 2, 3, 4, 5, 6];
      var indexOfCurrentPage = 5;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(pageLinks[1], "...");
    },
    "5b) If ((pageList.length-1) - indexOfCurrentPage) > 3, replace all elements between pageLinks(indexOfCurrentPage) and pageLinks[pageLinks.length-1] with a single '...' element.": function() {
      var allPages = [1, 2, 3, 4, 5, 6];
      var indexOfCurrentPage = 0;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(pageLinks[pageLinks.length - 2], "...");
    },

    // If allPages.length > 4: location of allPages[indexOfCurrentPage] in the returned array:

    "6a) If indexOfCurrentPage is more than 3 elements after the first element in array , the fifth element in pageLinks is equal to pageList[indexOfCurrentPage].": function() {
      var allPages = [1, 2, 3, 4, 5, 6];
      var indexOfCurrentPage = 5;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(pageLinks[4], allPages[indexOfCurrentPage]);
    },
    "6b) If indexOfCurrentPage is more than 3 elements before the last element in array, the third to last element in pageLinks is equal to pageList[indexOfCurrentPage].": function() {
      var allPages = [1, 2, 3, 4, 5, 6];
      var indexOfCurrentPage = 0;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(pageLinks[pageLinks.length - 4], allPages[indexOfCurrentPage]);
    },

    // If allPages.length > 4: the length of the returned array:

    "7a) It should never return an array with more than 9 elements.": function() {
      var allPages = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
      var indexOfCurrentPage = 6;
      var pageLinks = setPageLinks(allPages, indexOfCurrentPage);
      eq(pageLinks.length, 9);
    }
  });

  // TODO: Review different test cases:

  // 1) If indexOfCurrentPage is the first page of the array:
  // setPageLinks([1, 2, 3, 4, 5], 1); // >>> ["1", "2", "3", "4", "5"]
  // setPageLinks([1, 2, 3, 4, 5, 6], 1); // >>> ["1", "2", "3", "..." , "6"]

  // 2) If indexOfCurrentPage is the second page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6], 2); // >>> ["1", "2", "3", "4" , "5", "6"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7], 2); // >>> ["1", "2", "3", "4" , "...", "7"]

  // 3) If indexOfCurrentPage is the third page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6, 7], 3); // >>> ["1", "2", "3", "4" , "5", "6", "7"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8], 3); // >>> ["1", "2", "3", "4" , "5", "...", "8"]

  // 4) If indexOfCurrentPage is the fourth page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8], 4); // >>> ["1", "2", "3", "4" , "5", "6", "7", "8"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9], 4); // >>> ["1", "2", "3", "4" , "5", "6", "...", "9"]

  // 5) If indexOfCurrentPage is the fifth page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9], 5); // >>> ["1", "2", "3", "4" , "5", "6", "7", "8", "9"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], 5); // >>> ["1", "2", "3", "4" , "5", "6", "7", "...", "10"]

  // 6) If indexOfCurrentPage is the sixth page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9], 6); // >>> ["1", "...", "4" , "5", "6", "7", "8", "9"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], 6); // >>> ["1", "...", "4" , "5", "6", "7", "8", "9", "10"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], 6); // >>> ["1", "...", "4" , "5", "6", "7", "8", "...", "11"]

  // 7) If indexOfCurrentPage is the seventh page of the array:
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], 7); // >>> ["1", "...", "5", "6", "7", "8", "9", "10"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], 7); // >>> ["1", "...", "5", "6", "7", "8", "9", "10", "11"]
  // setPageLinks([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], 7); // >>> ["1", "...", "5", "6", "7", "8", "9", "...", "12"]
</script>
