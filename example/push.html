<script src="../simpletest.js"></script>
<script>
  // Summary:
  // Adds one or more elements to the end of an array.

  // Example:
  // var array = [1, 2, 3];
  // push(array, 4) >>> array === [1, 2, 3, 4];

  // Prototype implementation:
  // var array = [1, 2, 3];

  // function push(array, optionalElements) {
  //   var indexToPushElement = array.length;

  //   for (var i = 1; i < arguments.length; i++) {
  //     var elementToPush = arguments[i];
  //     array[indexToPushElement] = elementToPush;
  //     indexToPushElement++;
  //   }

  //   return array.length;
  // }

  // push(array, 4, 5);
  // console.log(array);
  // console.log(array.length);

  // Function signature:
  // push(array, optionalElements);

  // Arguments:
  // optionalElements: Sequence of elements to add to the end of array.
  // e.g. push([1], 2, 3, 4);

  // Return value:
  // The new length of array.

  // Requirements:

  // Function Syntax:
  function push(originalArguments) {
    var indexOfElementToBePushed, objectToModify;

    // If .call() or .apply was used to manually set the this value:
    if (Object.prototype.toString.call(this) !== "[object Window]") {
      objectToModify = this;
      indexOfElementToBePushed = 0;
    } else {
      objectToModify = arguments[0];
      indexOfElementToBePushed = 1;
    }

    // If the length property is not a number:
    if (isNaN(objectToModify.length)) {
      objectToModify.length = 0;
    }

    var indexToPushElement = objectToModify.length;

    for (var i = indexOfElementToBePushed; i < arguments.length; i++) {
      var elementToPush = arguments[i];
      objectToModify[indexToPushElement] = elementToPush;
      indexToPushElement++;
    }

    objectToModify.length = indexToPushElement;
    return objectToModify.length;
  }

  tests({
    "1a) It should return a number.": function() {
      var pushedValue = push([1]);
      eq(typeof pushedValue === "number", true);
    },

    "2a) If array.length === 1, it should add an element to the end of array.": function() {
      var arrayWithOneElement = [1];
      push(arrayWithOneElement, 2);
      eq(arrayWithOneElement.length, 2);
      eq(arrayWithOneElement[1], 2);
    },
    "2b) If array.length > 1, it should add an element to the end of array.": function() {
      var arrayWithMultipleElements = [1, 2];
      push(arrayWithMultipleElements, 3);
      eq(arrayWithMultipleElements.length, 3);
      eq(arrayWithMultipleElements[2], 3);
    },
    "2c) It should add multiple elements to the end of array.": function() {
      var array = [1];
      push(array, 2, 3);
      eq(array[1], 2);
      eq(array[2], 3);
      eq(array.length, 3);
    },

    "3a) It should modify array, instead of creating a new array.": function() {
      var array = [1];
      var duplicateArray = array;
      push(array, 2);
      eq(array, duplicateArray);
    },
    "4a) It should return the new length of the modified array.": function() {
      var pushedValue = push([1, 2]);
      eq(pushedValue, 2);
    },

    "5a) It should be able to be used with call().": function() {
      var array = [0];
      push.call(array, 1);
      eq(array.length, 2);
      eq(array[0], 0);
      eq(array[1], 1);
    },
    "5b) It should be able to be used with apply().": function() {
      var array = [0];
      var argumentArray = [1, 2];
      push.apply(array, argumentArray);
      eq(array.length, 3);
      eq(array[0], 0);
      eq(array[1], 1);
      eq(array[2], 2);
    },

    "6a) If array is object, it should work when used with call.": function() {
      var testObject = {};
      push.call(testObject, 0);
      eq(testObject[0], 0);
      eq(testObject.length, 1);
    },

    "7a) It object has length, and length is a number, begin insertion at index length.": function() {
      var testObjectWhereLengthNotZero = {
        length: 10
      };
      push.call(testObjectWhereLengthNotZero, "a");
      eq(testObjectWhereLengthNotZero[10], "a");
      eq(testObjectWhereLengthNotZero.length, 11);
    },
    "7b) It object has length, and length is 0, use the index 0.": function() {
      var testObjectWhereLengthIsZero = {
        length: 0
      };
      push.call(testObjectWhereLengthIsZero, "a");
      eq(testObjectWhereLengthIsZero[0], "a");
      eq(testObjectWhereLengthIsZero.length, 1);
    },
    "7c) If object has length, but length is not a number, use the index 0.": function() {
      var testObjectWhereLengthNotNumber = {
        length: "string"
      };
      push.call(testObjectWhereLengthNotNumber, "a");
      eq(testObjectWhereLengthNotNumber[0], "a");
      eq(testObjectWhereLengthNotNumber.length, 1);
    },
    "7d) If object does not have length, create length property.": function() {
      var testObjectWithoutLength = {
        key: "value"
      };
      eq(testObjectWithoutLength.length, undefined);
      push.call(testObjectWithoutLength, "a");
      eq(testObjectWithoutLength.length, 1);
    },

    "8a) If array is a string, null or undefined, it should return typeError.": function() {
      // TODO: Test different possible messages to be triggered with typeError.
      fail();
      // var isTypeError = false;
      // debugger;

      // try {
      //   function pushArguments() {
      //     push.call(null, 1);
      //   }
      //   pushArguments();
      // } catch (e) {
      //   isTypeError = e instanceof TypeError;
      // }
      // eq(isTypeError, true);
    }
  });

  /*

  // SPECS:

  // 1) Let O be the result of calling ToObject passing the this value as an argument
  // TODO: What is ToObject?
  let O = toObject(this);
  // 2) Let lenVal be the result of calling the [[Get]] internal method of O with argument "length".
  // TODO: What is an internal method?
  // TODO: What is a get method?
  let lenVal = O.get(O.length);
  // 3) Let n be ToUint32(lenVal).
  // TODO: What is ToUnit32?
  n = ToUint32(lenVal);
  // 4) Let items be an internal List whose elements are, in left to right order, the arguments that were passed to this function invocation
  let items = arguments;
  // 5) Repeat, while items is not empty
  while (items.length < 0) {
    // a. Remove the first element from items and let E be the value of the element.
    let E = items[i];
    items.shift();
    // b. Call the [[Put]] internal method of O with arguments ToString(n), E, and true.
    // TODO: What is the Put internal method?
    O.put(ToString(n), E, true);
    // c. Increase n by 1.
    n++;
  }
  // 6) Call the [[Put]] internal method of O with arguments "length", n, and true.
  // TODO: What does the bold "length" text mean?
  O.put(O.length, n, true);
  // 7) Return n.
  return n;

  // var testArray = [0, 1];
  // var testNumberElement = 0;
  // var testStringElement = "string";
  // var testBooleanElement = true;
  // var testNullElement = null;
  // var testUndefinedElement = undefined;
  // var testArrayElement = [];
  // var testObjectElement = {};

  */
</script>
